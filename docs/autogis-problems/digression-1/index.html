<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/auto-gis-with-rust-blog/css/main.css">
    <title></title>
</head>

<body class="site-body">
    
<header class="site-header">
    <div class="site-header__content">
        <h1 class="site-title">
            <a href="/auto-gis-with-rust-blog/" class="site-title__text">AutoGIS with Rust</a>
        </h1>
        <nav class="site-nav">
    <button type="button" class="hamburger" id="hamburger-button" aria-haspopup="true" aria-controls="site-nav-items">
        <div class="hamburger__top-row"></div>
        <div class="hamburger__middle-row"></div>
        <div class="hamburger__bottom-row"></div>
    </button>
    <ul id="site-nav-items" class="site-nav__items" role="menu" aria-labelledby="hamburger-button">
        <li class="site-nav__item" role="none"><a class="site-nav__link" role="menuitem"
                href="/auto-gis-with-rust-blog/autogis-problems/introduction/">Introduction</a>
        </li>
        <li class="site-nav__item" role="none">
            <button type="button" class="site-nav__link dropdown__button" id="problems-dropdown-button"
                aria-haspopup="true" aria-controls="problems-dropdown-items"><span>Problems</span><svg
                    xmlns="http://www.w3.org/2000/svg" class="dropdown__expand" id="problems-dropdown-expand">
                    <path d="m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z" />
                </svg></button>
            <ul id="problems-dropdown-items" class="dropdown__items" role="menu"
                aria-labelledby="problems-dropdown-button">
                <li class="dropdown__item" role="none"><a class="dropdown__link" role="menuitem"
                        href="/auto-gis-with-rust-blog/autogis-problems/problem-1/">1: Creating basic geometries</a>
                </li>
                <li class="dropdown__item" role="none"><a class="dropdown__link" role="menuitem"
                        href="/auto-gis-with-rust-blog/autogis-problems/digression-1/">Digression 1: The Other GeoArrow Types</a>
                </li>
            </ul>
        </li>
    </ul>
</nav>
    </div>
</header>
<main class="page-body">
    <article>
        <h1>Digression 1: The Other GeoArrow Types</h1>
        <p>To complete <a href="/autogis-problems/problem-1.md">Problem 1</a> we had to define types to represent points, line strings, and polygons but the <a href="https://github.com/geoarrow/geoarrow/blob/main/format.md">GeoArrow spec</a> also collections of those geometries in the form of <code>MultiPoint</code>, <code>MultiLineString</code>, and <code>MultiPolygon</code>. Let's define those too!</p>
<h2>MultiPoint</h2>
<p>The GeoArrow definition is:</p>
<blockquote>
<p>An array of MultiPoints is represented as a nested list array, where each outer list is a single MultiPoint (i.e. a list of xy coordinates). The child name of the outer List should be &quot;points&quot;.</p>
</blockquote>
<p>Okay, so let's add a definition of a <code>MultiPoint</code> type to the bottom of our <code>point.rs</code> file.</p>
<pre class="language-rust"><code class="language-rust"><span class="token comment">// point.rs</span><br><br><span class="token punctuation">...</span><br><span class="token attribute attr-name">#[derive(Debug, PartialEq, PartialOrd)]</span><br><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MultiPoint</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">impl</span> <span class="token class-name">MultiPoint</span> <span class="token punctuation">{</span><br>    <span class="token comment">/// Construct a new `MultiPoint`.</span><br>    <span class="token comment">///</span><br>    <span class="token comment">/// # Examples:</span><br>    <span class="token comment">///</span><br>    <span class="token comment">/// Construct a new multi-point vector of `Point`s.</span><br>    <span class="token comment">///</span><br>    <span class="token comment">/// ```</span><br>    <span class="token comment">/// use auto_gis_with_rust::point::{Point, MultiPoint};</span><br>    <span class="token comment">///</span><br>    <span class="token comment">/// let point_0 = Point::new(0.0, 0.0);</span><br>    <span class="token comment">/// let point_1 = Point::new(1.0, 0.0);</span><br>    <span class="token comment">/// let multi_point_0 = MultiPoint(vec![point_0, point_1]);</span><br><br>    <span class="token comment">/// let point_2 = Point::new(0, 0);</span><br>    <span class="token comment">/// let point_3 = Point::new(1, 0);</span><br>    <span class="token comment">/// let multi_point_1 = MultiPoint(vec![point_2, point_3]);</span><br>    <span class="token comment">///</span><br>    <span class="token comment">/// assert_eq!(multi_point_0, multi_point_1);</span><br>    <span class="token comment">/// ```</span><br>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>points<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token class-name">MultiPoint</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Looks good but it doesn't compile.</p>
<pre class="language-sh"><code class="language-sh">error<span class="token punctuation">[</span>E0423<span class="token punctuation">]</span>: cannot initialize a tuple struct <span class="token function">which</span> contains private fields<br>  --<span class="token operator">></span> src/point.rs:43:21<br>   <span class="token operator">|</span><br><span class="token number">8</span>  <span class="token operator">|</span> <span class="token builtin class-name">let</span> multi_point_0 <span class="token operator">=</span> MultiPoint<span class="token punctuation">(</span>vec<span class="token operator">!</span><span class="token punctuation">[</span>point_0, point_1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>   <span class="token operator">|</span>                     ^^^^^^^^^^<br>   <span class="token operator">|</span><br>note: constructor is not visible here due to private fields<br>  --<span class="token operator">></span> /home/ed/repos/auto-gis-with-rust/src/point.rs:29:23<br>   <span class="token operator">|</span><br><span class="token number">29</span> <span class="token operator">|</span> pub struct MultiPoint<span class="token punctuation">(</span>Vec<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>   <span class="token operator">|</span>                       ^^^^^^^^^^ private field</code></pre>
<p>Ah, okay, we need to add <code>pub</code> before <code>Vec&lt;Point&gt;</code> in the <code>struct</code> signature.</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br>...<br>#[derive(Debug, PartialEq, PartialOrd)]<br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MultiPoint</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MultiPoint</span><span class="token punctuation">(</span><span class="token keyword">pub</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><br>impl MultiPoint {<br>...</code></pre>
<p>Now it works but two things are bugging me:</p>
<ol>
<li>Comparing a <code>Point</code> / <code>MultiPoint</code> built from floats to one built integers doesn't feel great. Wouldn't it be easier if we had a nice way of representing them that we could also use to assert their correctness?</li>
<li>Wouldn't it be better if we build a <code>Point</code> directly from a 2-element array and a <code>MultiPoint</code> from a vector of 2-element arrays?</li>
</ol>
<p>I think <a href="https://portal.ogc.org/files/?artifact_id=25355">Well-Known Text (WKT)</a> could be a nice solution to the first problem, so let's try that.</p>
<h3>WKT for <code>Point</code></h3>
<p>Essentially, what we're doing here is converting a <code>Point</code> to a string, so let's google that. Right, the <a href="https://doc.rust-lang.org/std/string/trait.ToString.html">Rust docs</a> say we should implement <code>Display</code> instead:</p>
<blockquote>
<p>This trait is automatically implemented for any type which implements the Display trait. As such, ToString shouldn’t be implemented directly: Display should be implemented instead, and you get the ToString implementation for free.</p>
</blockquote>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br></span>use num_traits::{self, NumCast};<br>...<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">/// let point_1 = Point::new(0, 1);</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("POINT (0 1)", point_0.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br></span><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">/// assert_eq!(point_0, point_1);</span><br></span>...<br>}<br><br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"POINT ({} {})"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><br></span>#[derive(Debug, PartialEq, PartialOrd)]<br>...</code></pre>
<p>Cool, now we have a nice way of representing our points that will make it easier to write Doctests. Let's do the same for <code>MultiPoint</code>.</p>
<h3>WKT for <code>MultiPoint</code></h3>
<p>The problem with <code>MultiPoint</code>, when it comes to formatting as WKT, is that it can contain an arbitrary number of <code>Point</code>. We need something similar to <code>&quot;, &quot;.join()</code> in Python. <code>itertools</code> has a <code>format_with</code> function that looks just the ticket but, for that to work, we need <code>MultiPoint</code> to be a <code>Iterator</code>.</p>
<p>This feels like cheating but it looks like we can simply expose the underlying <code>Vec</code>'s <code>.iter</code> method:</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>fmt<span class="token punctuation">,</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token class-name">Iter</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br></span>...<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>points<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token class-name">MultiPoint</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Returns an iterator of `Points`</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # Example</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::point::{Point, MultiPoint};</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let point_0 = Point::new(0.0, 0.0);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let point_1 = Point::new(1, 0);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_point = MultiPoint(vec![point_0, point_1]);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("POINT (0 0)", multi_point.iter().next().unwrap().to_string())</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br></span>}</code></pre>
<p>We can then use call <code>format_with</code> on this <code>Iterator</code>:</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br>use std::{fmt, slice::Iter};<br><br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">itertools<span class="token punctuation">::</span></span><span class="token class-name">Itertools</span><span class="token punctuation">;</span><br></span>use num_traits::{self, NumCast};<br>...<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">MultiPoint</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">let</span> points <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>            <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token number">.0</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token number">.0</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"MULTIPOINT ({})"</span><span class="token punctuation">,</span> points<span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<p>This allows us to simplify our docstrings:</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br>...<br>impl MultiPoint {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">/// Construct a new `MultiPoint`.</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// # Examples:</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// Construct a new multi-point vector of `Point`s.</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// ```</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// use auto_gis_with_rust::point::{Point, MultiPoint};</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// let point_0 = Point::new(0.0, 0.0);</span><br></span><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span>    <span class="token comment">/// let point_1 = Point::new(1.0, 0.0);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let multi_point_0 = MultiPoint(vec![point_0, point_1]);</span><br><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let point_2 = Point::new(0, 0);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let point_3 = Point::new(1, 0);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let multi_point_1 = MultiPoint(vec![point_2, point_3]);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// assert_eq!(multi_point_0, multi_point_1);</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>    <span class="token comment">/// let point_1 = Point::new(1, 0);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_point = MultiPoint(vec![point_0, point_1]);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("MULTIPOINT (0 0, 1 0)", multi_point.to_string());</span><br></span>...</code></pre>
<h3>From 2-element array for <code>Point</code></h3>
<p>A two-element array of any type that implements <code>NumCast</code> and <code>Copy</code> can be converted into a <code>Point</code>, so we just need to implement the <code>From</code> trait.</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br>...<br>impl fmt::Display for Point {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"POINT ({} {})"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span> <span class="token operator">+</span> <span class="token class-name">Copy</span><span class="token operator">></span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Construct a `Point` from a 2-element array.</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # Examples:</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::point::Point;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let point = Point::from([0.0, 1.0]);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("POINT (0 1)", point.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token class-name">Point</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> coordinates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><br></span>#[derive(Debug, PartialEq, PartialOrd)]<br>pub struct MultiPoint(pub Vec&lt;Point>);<br>...</code></pre>
<p>This doesn't appear to get us much but it makes the next bit a lot easier.</p>
<h3>From a vector of 2-element arrays for <code>MultiPoint</code></h3>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br>...<br>impl fmt::Display for MultiPoint {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> points <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({} {})"</span><span class="token punctuation">,</span> point<span class="token number">.0</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token number">.0</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"MULTIPOINT ({})"</span><span class="token punctuation">,</span> points<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span> <span class="token operator">+</span> <span class="token class-name">Copy</span><span class="token operator">></span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">>></span> <span class="token keyword">for</span> <span class="token class-name">MultiPoint</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Construct a `MultiPoint` from a vector of 2-element arrays.</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # Examples:</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::point::MultiPoint;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_point = MultiPoint::from(vec![[0.0, 0.0], [1.0, 0.0]]);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("MULTIPOINT ((0 0), (1 0))", multi_point.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">let</span> points<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span> <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">::</span>from<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span>        <span class="token class-name">MultiPoint</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<p>Okay, great, now we have a <code>MultiPoint</code>type that can be constructed from a vector of <code>Point</code>s or a vector of 2-element arrays and can be converted to WKT.</p>
<h2>MultiLineString</h2>
<h3>WKT for <code>LineString</code></h3>
<p><code>MultiLineString</code> next but, before we do that, let's implement WKT for <code>LineString</code>.</p>
<pre class="language-diff-rust"><code class="language-diff-rust"><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>fmt<span class="token punctuation">,</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token class-name">Iter</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">itertools<span class="token punctuation">::</span></span><span class="token class-name">Itertools</span><span class="token punctuation">;</span><br></span>use num_traits::NumCast;<br>...<br>impl LineString {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">/// Construct a new `LineString` from a vector of 2-element arrays.</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// # Examples:</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::line_string::LineString;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let line_string_1 = LineString::new(vec![[0., 0.], [1., 0.], [1., 1.]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("LINESTRING (0 0, 1 0, 1 1)", line_string_1.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br></span><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// Construct a new `LineString` from a vector of floats or a vector of integers.</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// ```</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// use auto_gis_with_rust::line_string::LineString;</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br></span><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span>    <span class="token comment">/// let line_string_1 = LineString::new(vec![[0., 0.], [1., 1.]]);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let line_string_2 = LineString::new(vec![[0, 0], [1, 1]]);</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>    <span class="token comment">/// let line_string_1 = LineString::new(vec![[0., 0.], [1., 0.], [1., 1.]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let line_string_2 = LineString::new(vec![[0, 0], [1, 0], [1, 1]]).unwrap();</span><br></span><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// assert_eq!(line_string_1, line_string_2);</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// ```</span><br><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span><span class="token punctuation">(</span>coordinates<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">...</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Returns an iterator of 2 64-bit float arrays.</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br></span>}<br><br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">LineString</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">let</span> points <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>            <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"LINESTRING ({})"</span><span class="token punctuation">,</span> points<span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<p>I'm also adding an extra segment to each of the <code>LineString</code>s in the example for reasons that I will get into later.</p>
<h3><code>new</code> and WKT for <code>MultiLineString</code></h3>
<p>Okay, now that's done, let's get on with it. The GeoArrow spec for MultiLineString is as follows:</p>
<blockquote>
<p>An array of MultiLineStrings is represented as a nested list array with two levels of outer nesting: each element of the array (MultiLineString) is a list of LineStrings, which consist itself of a list xy vertices (see above). The child name of the outer list should be &quot;linestrings&quot;; the child name of the inner list should be &quot;vertices&quot;.</p>
</blockquote>
<p>To do this, we'll need a <code>MultiLineString</code> <code>struct</code> with a <code>new</code> constructor. I want to use WKT in the doctest, so we'll also need to implement <code>Display</code> and to display a <code>MultiLineString</code> composed of an arbitrary number of <code>LineStrings</code>, we'll need to be able to convert <code>MultiLineString</code> to an iterator we can call <code>itertools</code>' <code>.format_with</code> on.</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// line_string.rs<br><br>...<br>impl fmt::Display for LineString {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> points <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"LINESTRING ({})"</span><span class="token punctuation">,</span> points<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token attribute attr-name">#[derive(Debug, PartialEq, PartialOrd)]</span><br><span class="token prefix inserted">+</span><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MultiLineString</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token class-name">MultiLineString</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Construct a new `MultiLineString` from a vector of 'LineString's.</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # Examples:</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::line_string::{LineString, MultiLineString};</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let line_string_1 = LineString::new(vec![[0., 0.], [1., 0.], [1., 1.]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let line_string_2 = LineString::new(vec![[1., 2.], [0., 2.], [0., 1.]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_line_string = MultiLineString::new(vec![line_string_1, line_string_2]);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("MULTILINESTRING ((0 0, 1 0, 1 1), (1 2, 0 2, 0 1))", multi_line_string.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>linestrings<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token class-name">MultiLineString</span><span class="token punctuation">(</span>linestrings<span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Returns an iterator of `LineStrings`</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # Examples</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::line_string::{LineString, MultiLineString};</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let line_string_1 = LineString::new(vec![[0., 0.], [1., 0.], [1., 1.]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let line_string_2 = LineString::new(vec![[1., 2.], [0., 2.], [0., 1.]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_line_string = MultiLineString::new(vec![line_string_1, line_string_2]);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("LINESTRING (0 0, 1 0, 1 1)", multi_line_string.iter().next().unwrap().to_string())</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">MultiLineString</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">let</span> line_strings <span class="token operator">=</span> <span class="token keyword">self</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>line_string<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>                line_string<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>                    <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>line_string<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({})"</span><span class="token punctuation">,</span> line_string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"MULTILINESTRING ({})"</span><span class="token punctuation">,</span> line_strings<span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<h3>From a vector of vectors of 2-element arrays for <code>MultiLineString</code></h3>
<p>It would also be useful if we could construct a <code>MultiLineString</code> from a vector of vectors of 2-element floats instead of needing a vector of <code>LineString</code>, so let's implement a converter. However, as <code>LineString::new</code> will fail if the inner vectors have less than 2 2-float arrays, this will need to be a <code>TryFrom</code>.</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// line_string.rs<br><br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>convert<span class="token punctuation">::</span></span><span class="token class-name">TryFrom</span><span class="token punctuation">;</span><br></span>use std::{fmt, slice::Iter};<br>...<br>impl fmt::Display for MultiLineString {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> line_strings <span class="token operator">=</span> <span class="token keyword">self</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>line_string<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>               line_string<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>                   <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>               <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>line_string<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({})"</span><span class="token punctuation">,</span> line_string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"MULTILINESTRING ({})"</span><span class="token punctuation">,</span> line_strings<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span> <span class="token class-name">TryFrom</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">MultiLineString</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Error</span> <span class="token operator">=</span> <span class="token class-name">GeometryError</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Tries to convert a vector of vectors of 2-float arrays into a `MultiLineString`.</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # Examples:</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use std::convert::TryFrom;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::line_string::{LineString, MultiLineString};</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_line_string = MultiLineString::try_from(vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///    vec![[0., 0.], [1., 0.], [1., 1.]],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///    vec![[1., 2.], [0., 2.], [0., 1.]],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("MULTILINESTRING ((0 0, 1 0, 1 1), (1 2, 0 2, 0 1))", multi_line_string.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">try_from</span><span class="token punctuation">(</span>vectors<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">let</span> line_strings<span class="token punctuation">:</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token operator">=</span><br><span class="token prefix inserted">+</span>            vectors<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">::</span>new<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">MultiLineString</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>line_strings<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<p>Fantastic, now we have a <code>MultiLineString</code>type that can be constructed from a vector of <code>LineString</code>s or a vector of vectors of 2-element arrays and can be converted to WKT.</p>
<h2>MultiPolygon</h2>
<p>You should know the drill by now, first we're going to implement WKT for <code>Polygon</code>, then define a <code>MultiPolygon</code> type with a <code>new</code> constructor and a WKT <code>Display</code>method, and finally ...</p>
<h3>WKT for <code>Polygon</code></h3>
<p>The example given by the <a href="http://www.opengis.net/doc/is/sfa/1.2.1">Open Geospatial Consortium's <em>OpenGIS® Implementation Standard for Geographic information - Simple feature access - Part 1: Common architecture</em></a> is:</p>
<blockquote>
<p>Polygon ((10 10, 10 20, 20 20, 20 15, 10 10))</p>
</blockquote>
<p>Which represents:</p>
<blockquote>
<p>a Polygon with 1 exteriorRing and 0 interiorRings</p>
</blockquote>
<p>This is essentially the same as the <code>MultiLineString</code> representation so, with luck, we can reuse the same pattern.</p>
<p>With that in mind, we'll need to do it implement WKT for <code>PolygonRing</code>, which means that the first thing we need to do it implement an <code>.iter</code>method for <code>PolygonRing</code>.</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// polygon.rs<br>use num_traits::NumCast;<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>slice<span class="token punctuation">::</span></span><span class="token class-name">Iter</span><span class="token punctuation">;</span><br></span><br>use crate::error::GeometryError;<br>...<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span><span class="token punctuation">(</span>coordinates<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> number_of_coordinates <span class="token operator">=</span> coordinates<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">if</span> number_of_coordinates <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">GeometryError</span><span class="token punctuation">::</span><span class="token class-name">TooFewCoords</span><span class="token punctuation">(</span>number_of_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           <span class="token keyword">let</span> <span class="token keyword">mut</span> float_coordinates <span class="token operator">=</span> <span class="token namespace">helpers<span class="token punctuation">::</span></span><span class="token function">get_float_coordinates</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>           <span class="token keyword">if</span> float_coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> float_coordinates<span class="token punctuation">[</span>number_of_coordinates <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>               float_coordinates<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>float_coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>               <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">PolygonRing</span><span class="token punctuation">(</span>float_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>               <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">PolygonRing</span><span class="token punctuation">(</span>float_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">}</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>    <br><span class="token prefix inserted">+</span>    <span class="token comment">/// Returns an iterator of 2 64-bit float arrays.</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br></span>}</code></pre>
<p>Easy-peazy, we can just copy the code from <code>line_string.rs</code>. But wait, that can't be right, this is shared functionality. The Rustacean way of doing that is with traits.</p>
<pre class="language-rust"><code class="language-rust"><span class="token comment">// curve.rs</span><br><br><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Curve</span> <span class="token punctuation">{</span><br>    <span class="token comment">/// Returns an iterator of 2 64-bit float arrays.</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<pre class="language-diff-rust"><code class="language-diff-rust">// lib.rs<br><br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">curve</span><span class="token punctuation">;</span><br></span>pub mod error;<br>pub mod helpers;<br>pub mod line_string;<br>pub mod point;<br>pub mod polygon;</code></pre>
<p>But wait, that won't work because the compiler cant' guaranetee that the <code>Trait</code>will be implemented on <code>struct</code>s that have a zeroth field or that that zeroth field with have a <code>.iter</code>method.</p>
<p>Back to the drawing-board!</p>
<p>Another option is is a implement <code>Deref</code>, this will allow us to call any underlying <code>vec</code>methods on our new types that wrap a <code>vec</code>.</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// polygon.rs<br><br>...<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span><span class="token punctuation">(</span>coordinates<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> number_of_coordinates <span class="token operator">=</span> coordinates<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">if</span> number_of_coordinates <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">GeometryError</span><span class="token punctuation">::</span><span class="token class-name">TooFewCoords</span><span class="token punctuation">(</span>number_of_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           <span class="token keyword">let</span> <span class="token keyword">mut</span> float_coordinates <span class="token operator">=</span> <span class="token namespace">helpers<span class="token punctuation">::</span></span><span class="token function">get_float_coordinates</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>           <span class="token keyword">if</span> float_coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> float_coordinates<span class="token punctuation">[</span>number_of_coordinates <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>               float_coordinates<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>float_coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>               <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">PolygonRing</span><span class="token punctuation">(</span>float_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>               <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">PolygonRing</span><span class="token punctuation">(</span>float_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">}</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">PolygonRing</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br></span><br>#[derive(Debug, PartialEq, PartialOrd)]<br>pub struct Polygon(Vec&lt;PolygonRing>);<br><br>impl Polygon {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">/// Construct a new `Polygon` from a vector of vectors of 2-element arrays.</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// # Examples:</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::polygon::Polygon;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let polygon_1 = Polygon::new(vec![vec![[0., 0.], [0., 1.], [1., 1.], [0., 0.]]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("POLYGON ((0 0, 0 1, 1 1, 0 0))", polygon_1.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br></span><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// Construct a new `Polygon` from a vector of vectors of floats or a vector of vectors of integers.</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// ```</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// use auto_gis_with_rust::polygon::Polygon;</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// let polygon_1 = Polygon::new(vec![vec![[0., 0.], [0., 1.], [1., 1.], [0., 0.]]]).unwrap();</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// let polygon_2 = Polygon::new(vec![vec![[0, 0], [0, 1], [1, 1]]]).unwrap();</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// assert_eq!(polygon_1, polygon_2)</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// ```</span><br><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span><span class="token punctuation">(</span>rings<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>          <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span><span class="token punctuation">(</span>rings<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> polygon_rings<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">PolygonRing</span><span class="token operator">></span> <span class="token operator">=</span> rings<br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">PolygonRing</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>ring<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Polygon</span><span class="token punctuation">(</span>polygon_rings<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">Polygon</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">PolygonRing</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">Polygon</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">let</span> rings <span class="token operator">=</span> <span class="token keyword">self</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>                ring<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>                    <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({})"</span><span class="token punctuation">,</span> ring<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"POLYGON ({})"</span><span class="token punctuation">,</span> rings<span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<p>Cool, that works, time to:</p>
<h3>Dereference all the things!</h3>
<pre class="language-diff-rust"><code class="language-diff-rust"><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>fmt<span class="token punctuation">,</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token class-name">Iter</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>fmt<span class="token punctuation">,</span> <span class="token namespace">ops<span class="token punctuation">::</span></span><span class="token class-name">Deref</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br></span>...<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> x_float<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> <span class="token namespace">num_traits<span class="token punctuation">::</span></span><span class="token function">cast</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> y_float<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> <span class="token namespace">num_traits<span class="token punctuation">::</span></span><span class="token function">cast</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x_float<span class="token punctuation">,</span> y_float<span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br></span><br>impl fmt::Display for Point {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br></span><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"POINT ({} {})"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"POINT ({} {})"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br></span><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br>...<br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span>    <span class="token comment">/// Returns an iterator of `Points`</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// # Example</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// ```</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// use auto_gis_with_rust::point::{Point, MultiPoint};</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let point_0 = Point::new(0.0, 0.0);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let point_1 = Point::new(1, 0);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let multi_point = MultiPoint(vec![point_0, point_1]);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// assert_eq!("POINT (0 0)", multi_point.iter().next().unwrap().to_string())</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// ```</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">MultiPoint</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br></span><br>impl fmt::Display for MultiPoint {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> points <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br></span><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span>            <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({} {})"</span><span class="token punctuation">,</span> point<span class="token number">.0</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token number">.0</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>            <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({} {})"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"MULTIPOINT ({})"</span><span class="token punctuation">,</span> points<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}</code></pre>
<pre class="language-diff-rust"><code class="language-diff-rust">// line_string.rs<br>use std::convert::TryFrom;<br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>fmt<span class="token punctuation">,</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token class-name">Iter</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Deref</span><span class="token punctuation">;</span><br></span>...<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span><span class="token punctuation">(</span>coordinates<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> number_of_coordinates <span class="token operator">=</span> coordinates<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">if</span> number_of_coordinates <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">GeometryError</span><span class="token punctuation">::</span><span class="token class-name">TooFewCoords</span><span class="token punctuation">(</span>number_of_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           <span class="token keyword">let</span> float_coordinates <span class="token operator">=</span> <span class="token namespace">helpers<span class="token punctuation">::</span></span><span class="token function">get_float_coordinates</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>           <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">(</span>float_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// Returns an iterator of 2 64-bit float arrays.</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">LineString</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br></span>...<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>linestrings<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token class-name">MultiLineString</span><span class="token punctuation">(</span>linestrings<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// Returns an iterator of `LineStrings`</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// # Examples</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// ```</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// use auto_gis_with_rust::line_string::{LineString, MultiLineString};</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let line_string_1 = LineString::new(vec![[0., 0.], [1., 0.], [1., 1.]]).unwrap();</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let line_string_2 = LineString::new(vec![[1., 2.], [0., 2.], [0., 1.]]).unwrap();</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// let multi_line_string = MultiLineString::new(vec![line_string_1, line_string_2]);</span><br><span class="token prefix deleted">-</span>    <span class="token comment">///</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// assert_eq!("LINESTRING (0 0, 1 0, 1 1)", multi_line_string.iter().next().unwrap().to_string())</span><br><span class="token prefix deleted">-</span>    <span class="token comment">/// ```</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Iter</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">MultiLineString</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<pre class="language-sh"><code class="language-sh"><span class="token punctuation">..</span>.<br>   Doc-tests auto-gis-with-rust<br><br>running <span class="token number">12</span> tests<br><span class="token builtin class-name">test</span> src/line_string.rs - line_string::LineString::new <span class="token punctuation">(</span>line <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/line_string.rs - line_string::MultiLineString::new <span class="token punctuation">(</span>line <span class="token number">73</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/line_string.rs - line_string::LineString::new <span class="token punctuation">(</span>line <span class="token number">29</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/helpers.rs - helpers::get_float_coordinates <span class="token punctuation">(</span>line <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/point.rs - point::Point::from <span class="token punctuation">(</span>line <span class="token number">52</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/point.rs - point::MultiPoint::new <span class="token punctuation">(</span>line <span class="token number">74</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/line_string.rs - line_string::MultiLineString::try_from <span class="token punctuation">(</span>line <span class="token number">117</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/point.rs - point::MultiPoint::from <span class="token punctuation">(</span>line <span class="token number">110</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. FAILED<br><span class="token builtin class-name">test</span> src/point.rs - point::Point::new <span class="token punctuation">(</span>line <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/polygon.rs - polygon::Polygon::new <span class="token punctuation">(</span>line <span class="token number">58</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/polygon.rs - polygon::PolygonRing::new <span class="token punctuation">(</span>line <span class="token number">18</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/polygon.rs - polygon::Polygon::new <span class="token punctuation">(</span>line <span class="token number">68</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><br>failures:<br><br>---- src/point.rs - point::MultiPoint::from <span class="token punctuation">(</span>line <span class="token number">110</span><span class="token punctuation">)</span> stdout ----<br>Test executable failed <span class="token punctuation">(</span>exit status: <span class="token number">101</span><span class="token punctuation">)</span>.<br><br>stderr:<br>thread <span class="token string">'main'</span> panicked at <span class="token string">'assertion failed: `(left == right)`<br>  left: `"MULTIPOINT (0 0, 1 0)"`,<br> right: `"MULTIPOINT ((0 0), (1 0))"`'</span>, src/point.rs:8:1<br>stack backtrace:<br><span class="token punctuation">..</span>.</code></pre>
<p>Wait, what?!</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br>...<br>impl&lt;T: NumCast + Copy> From&lt;Vec&lt;[T; 2]>> for MultiPoint {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">/// Construct a `MultiPoint` from a vector of 2-element arrays.</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// # Examples:</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// ```</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// use auto_gis_with_rust::point::MultiPoint;</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">/// let multi_point = MultiPoint::from(vec![[0.0, 0.0], [1.0, 0.0]]);</span><br><span class="token prefix unchanged"> </span>   <span class="token comment">///</span><br></span><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span>    <span class="token comment">/// assert_eq!("MULTIPOINT (0 0, 1 0)", multi_point.to_string());</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("MULTIPOINT ((0 0), (1 0))", multi_point.to_string());</span><br></span><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token comment">/// ```</span><br><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> points<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span> <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">::</span>from<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token class-name">MultiPoint</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>...</code></pre>
<pre class="language-sh"><code class="language-sh"><span class="token punctuation">..</span>.<br>   Doc-tests auto-gis-with-rust<br><br>running <span class="token number">12</span> tests<br><span class="token builtin class-name">test</span> src/line_string.rs - line_string::LineString::new <span class="token punctuation">(</span>line <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/line_string.rs - line_string::MultiLineString::new <span class="token punctuation">(</span>line <span class="token number">73</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/helpers.rs - helpers::get_float_coordinates <span class="token punctuation">(</span>line <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/line_string.rs - line_string::LineString::new <span class="token punctuation">(</span>line <span class="token number">29</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/point.rs - point::MultiPoint::new <span class="token punctuation">(</span>line <span class="token number">74</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/point.rs - point::Point::from <span class="token punctuation">(</span>line <span class="token number">52</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/point.rs - point::MultiPoint::from <span class="token punctuation">(</span>line <span class="token number">110</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/line_string.rs - line_string::MultiLineString::try_from <span class="token punctuation">(</span>line <span class="token number">117</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/point.rs - point::Point::new <span class="token punctuation">(</span>line <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/polygon.rs - polygon::Polygon::new <span class="token punctuation">(</span>line <span class="token number">58</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/polygon.rs - polygon::PolygonRing::new <span class="token punctuation">(</span>line <span class="token number">18</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><span class="token builtin class-name">test</span> src/polygon.rs - polygon::Polygon::new <span class="token punctuation">(</span>line <span class="token number">68</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok<br><br><span class="token builtin class-name">test</span> result: ok. <span class="token number">12</span> passed<span class="token punctuation">;</span> <span class="token number">0</span> failed<span class="token punctuation">;</span> <span class="token number">0</span> ignored<span class="token punctuation">;</span> <span class="token number">0</span> measured<span class="token punctuation">;</span> <span class="token number">0</span> filtered out<span class="token punctuation">;</span> finished <span class="token keyword">in</span> <span class="token number">2</span>.92s</code></pre>
<p>Much better, but something doesn't feel right, we're basically copy-pasting the implement-<code>Deref</code>code all over the place and that's a sure sign we need some form of abstraction.</p>
<p>Macros to the rescue!</p>
<p>Instead of copy-pasting the implement-<code>Deref</code>code, we can define an implement <code>Deref</code>macro that will generate the implementation block for us.</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// helpers.rs<br>// ...<br>pub fn get_float_coordinates&lt;T: NumCast>(coordinates: Vec&lt;[T; 2]>) -> Vec&lt;[f64; 2]> {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">let</span> float_coordinates<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">=</span> coordinates<br><span class="token prefix unchanged"> </span>       <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>coordinate<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>           coordinate<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>coordinate<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span> <span class="token namespace">num_traits<span class="token punctuation">::</span></span><span class="token function">cast</span><span class="token punctuation">(</span>coordinate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>       <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>   float_coordinates<br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token attribute attr-name">#[macro_export]</span><br><span class="token prefix inserted">+</span><span class="token macro property">macro_rules!</span> implement_deref <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ty</span><span class="token punctuation">,</span> <span class="token variable">$target</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ty</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token variable">$type</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>            <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token variable">$target</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>            <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>                <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span>        <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<p>Now we just have replace our implement <code>Deref</code>blocks with macro calls:</p>
<pre class="language-diff-rust"><code class="language-diff-rust">// point.rs<br><br>use num_traits::{self, NumCast};<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>implement_deref</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br></span>#[derive(Debug, PartialEq, PartialOrd)]<br><br>// ...<br><br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br><span class="token prefix deleted">-</span><span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token macro property">implement_deref!</span><span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><br>// ...<br><br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">MultiPoint</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br><span class="token prefix deleted">-</span><span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token macro property">implement_deref!</span><span class="token punctuation">(</span><span class="token class-name">MultiPoint</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><br>// ...</code></pre>
<pre class="language-diff-rust"><code class="language-diff-rust">// line_string.rs<br><br>// ..<br><br>use crate::error::GeometryError;<br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>helpers</span><span class="token punctuation">;</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token punctuation">{</span>helpers<span class="token punctuation">,</span> implement_deref<span class="token punctuation">}</span><span class="token punctuation">;</span><br></span><br>#[derive(Debug, PartialEq, PartialOrd)]<br><br>// ...<br><br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">LineString</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br><span class="token prefix deleted">-</span><span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token macro property">implement_deref!</span><span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><br>// ...<br><br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">MultiLineString</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br><span class="token prefix deleted">-</span><span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token macro property">implement_deref!</span><span class="token punctuation">(</span><span class="token class-name">MultiLineString</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">LineString</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><br>// ...<br></code></pre>
<pre class="language-diff-rust"><code class="language-diff-rust">// polygon.rs<br><br>// ..<br><br>use crate::error::GeometryError;<br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>helpers</span><span class="token punctuation">;</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token punctuation">{</span>helpers<span class="token punctuation">,</span> implement_deref<span class="token punctuation">}</span><span class="token punctuation">;</span><br></span><br>#[derive(Debug, PartialEq, PartialOrd)]<br><br>// ...<br><br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">PolygonRing</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br><span class="token prefix deleted">-</span><span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token macro property">implement_deref!</span><span class="token punctuation">(</span><span class="token class-name">PolygonRing</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f64</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><br>// ...<br><br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">Polygon</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">PolygonRing</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br><span class="token prefix deleted">-</span><span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token macro property">implement_deref!</span><span class="token punctuation">(</span><span class="token class-name">Polygon</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">PolygonRing</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><br>// ...<br><br><span class="token deleted-sign deleted language-rust"><span class="token prefix deleted">-</span><span class="token keyword">impl</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">MultiPolygon</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Polygon</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token prefix deleted">-</span><br><span class="token prefix deleted">-</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span><br><span class="token prefix deleted">-</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><br><span class="token prefix deleted">-</span>    <span class="token punctuation">}</span><br><span class="token prefix deleted">-</span><span class="token punctuation">}</span><br></span><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><span class="token macro property">implement_deref!</span><span class="token punctuation">(</span><span class="token class-name">MultiPolygon</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Polygon</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span><br>// ...<br></code></pre>
<h3><code>new</code>and WKT for <code>MultiPolygon</code></h3>
<pre class="language-diff-rust"><code class="language-diff-rust">// polygon.rs<br><br>// ...<br><br>impl fmt::Display for Polygon {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> rings <span class="token operator">=</span> <span class="token keyword">self</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>               ring<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>                   <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>               <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({})"</span><span class="token punctuation">,</span> ring<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"POLYGON ({})"</span><span class="token punctuation">,</span> rings<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token attribute attr-name">#[derive(Debug, PartialEq, PartialOrd)]</span><br><span class="token prefix inserted">+</span><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MultiPolygon</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Polygon</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token class-name">MultiPolygon</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Construct a new `MultiPolygon` from a vector of `Polygon`s.</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # Examples:</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::polygon::{MultiPolygon, Polygon};</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let polygon_1 = Polygon::new(vec![vec![[0., 0.], [0., 1.], [1., 1.], [1., 0.], [0., 0.]]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let polygon_2 = Polygon::new(vec![vec![[1, 1], [1, 2], [2, 2], [2, 1]]]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_polygon = MultiPolygon::new(vec![polygon_1, polygon_2]);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("MULTIPOLYGON (((0 0, 0 1, 1 1, 1 0, 0 0)), ((1 1, 1 2, 2 2, 2 1, 1 1)))", multi_polygon.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>polygons<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Polygon</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token class-name">MultiPolygon</span><span class="token punctuation">(</span>polygons<span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token macro property">implement_deref!</span><span class="token punctuation">(</span><span class="token class-name">MultiPolygon</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Polygon</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">MultiPolygon</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">let</span> polygons <span class="token operator">=</span> <span class="token keyword">self</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>polygon<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>                polygon<br><span class="token prefix inserted">+</span>                    <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>                        ring<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>                            <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>                    <span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({})"</span><span class="token punctuation">,</span> ring<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>            <span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>polygon<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({})"</span><span class="token punctuation">,</span> polygon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"MULTIPOLYGON ({})"</span><span class="token punctuation">,</span> polygons<span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span><br></span><br>// ...<br></code></pre>
<h3>From a vector of vectors of vectors of 2-element arrays for <code>MultiPolygon</code></h3>
<pre class="language-diff-rust"><code class="language-diff-rust">// polygon.rs<br><br>// ...<br><br>impl fmt::Display for MultiPolygon {<br><span class="token unchanged language-rust"><span class="token prefix unchanged"> </span>   <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>       <span class="token keyword">let</span> polygons <span class="token operator">=</span> <span class="token keyword">self</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>polygon<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>               polygon<br><span class="token prefix unchanged"> </span>                   <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>                   <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>                       ring<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>point<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br><span class="token prefix unchanged"> </span>                           <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>                       <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>                   <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>                   <span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>ring<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({})"</span><span class="token punctuation">,</span> ring<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>           <span class="token punctuation">.</span><span class="token function">format_with</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>polygon<span class="token punctuation">,</span> f<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span><span class="token string">"({})"</span><span class="token punctuation">,</span> polygon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix unchanged"> </span>       <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"MULTIPOLYGON ({})"</span><span class="token punctuation">,</span> polygons<span class="token punctuation">)</span><br><span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span><br></span>}<br><span class="token inserted-sign inserted language-rust"><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">NumCast</span><span class="token operator">></span> <span class="token class-name">TryFrom</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">>></span> <span class="token keyword">for</span> <span class="token class-name">MultiPolygon</span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Error</span> <span class="token operator">=</span> <span class="token class-name">GeometryError</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Tries to convert a vector of vectors of vectors of 2-float arrays into a `MultiPolygon`.</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # Examples:</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use std::convert::TryFrom;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// use auto_gis_with_rust::polygon::MultiPolygon;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_polygon_1 = MultiPolygon::try_from(vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///     vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///         vec![[0., 0.], [0., 1.], [1., 1.], [1., 0.], [0., 0.]],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///     ],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///     vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///         vec![[1., 1.], [1., 2.], [2., 2.], [2., 1.]],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///     ],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!("MULTIPOLYGON (((0 0, 0 1, 1 1, 1 0, 0 0)), ((1 1, 1 2, 2 2, 2 1, 1 1)))", multi_polygon_1.to_string());</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// Or tries to convert a vector of vectors of vectors of 2-integer arrays into a `MultiPolygon`.</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # use std::convert::TryFrom;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # use auto_gis_with_rust::polygon::MultiPolygon;</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// #    </span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # let multi_polygon_1 = MultiPolygon::try_from(vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// #     vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// #         vec![[0., 0.], [0., 1.], [1., 1.], [1., 0.], [0., 0.]],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// #     ],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// #     vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// #         vec![[1., 1.], [1., 2.], [2., 2.], [2., 1.]],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// #     ],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// # ]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// let multi_polygon_2 = MultiPolygon::try_from(vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///     vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///         vec![[0, 0], [0, 1], [1, 1], [1, 0], [0, 0]],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///     ],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///     vec![</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///         vec![[1, 1], [1, 2], [2, 2], [2, 1]],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///     ],</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ]).unwrap();</span><br><span class="token prefix inserted">+</span>    <span class="token comment">///</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// assert_eq!(multi_polygon_1, multi_polygon_2);</span><br><span class="token prefix inserted">+</span>    <span class="token comment">/// ```</span><br><span class="token prefix inserted">+</span>    <span class="token keyword">fn</span> <span class="token function-definition function">try_from</span><span class="token punctuation">(</span>vectors<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token prefix inserted">+</span>        <span class="token keyword">let</span> polygons<span class="token punctuation">:</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Polygon</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">GeometryError</span><span class="token operator">></span> <span class="token operator">=</span><br><span class="token prefix inserted">+</span>            vectors<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Polygon</span><span class="token punctuation">::</span>new<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token prefix inserted">+</span>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">MultiPolygon</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>polygons<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token prefix inserted">+</span>    <span class="token punctuation">}</span><br><span class="token prefix inserted">+</span><span class="token punctuation">}</span></code></pre>
<p>Right, that's enough for today, we have a <code>MultiPolygon</code>type that can be constructed from a vector of <code>Polygon</code>s or a vector of vectors of vectors of 2-element arrays and can be converted to WKT.</p>

    </article>
</main>

    <script src="/auto-gis-with-rust-blog/js/index.js"></script>
</body>

</html>