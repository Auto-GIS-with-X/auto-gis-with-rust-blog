<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/auto-gis-with-rust-blog/css/main.css">
    <title></title>
</head>

<body class="site-body">
    
<header class="site-header">
    <div class="site-header__content">
        <h1 class="site-title">
            <a href="/auto-gis-with-rust-blog/" class="site-title__text">AutoGIS with Rust</a>
        </h1>
        <nav class="site-nav">
    <button type="button" class="hamburger" id="hamburger-button" aria-haspopup="true" aria-controls="site-nav-items">
        <div class="hamburger__top-row"></div>
        <div class="hamburger__middle-row"></div>
        <div class="hamburger__bottom-row"></div>
    </button>
    <ul id="site-nav-items" class="site-nav__items" role="menu" aria-labelledby="hamburger-button">
        <li class="site-nav__item" role="none">
            <button type="button" class="site-nav__link dropdown__button" id="problems-dropdown-button"
                aria-haspopup="true" aria-controls="problems-dropdown-items">
                <span>Problems</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="dropdown__expand"
                    id="problems-dropdown-expand">
                    <path d="m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z" />
                </svg>
            </button>
            <ul id="problems-dropdown-items" class="dropdown__items" role="menu"
                aria-labelledby="problems-dropdown-button">
                <li class="dropdown__item" role="none">
                    <a class="dropdown__link" role="menuitem" href="/auto-gis-with-rust-blog/problems/01-creating-basic-geometries/">1: Creating basic geometries</a>
                </li>
                
                <li class="dropdown__item" role="none">
                    <a class="dropdown__link" role="menuitem" href="/auto-gis-with-rust-blog/problems/02-attributes-of-geometries/">2: Attributes of geometries</a>
                </li>
                </ul>
        </li><li class="site-nav__item" role="none">
            <button type="button" class="site-nav__link dropdown__button" id="digressions-dropdown-button"
                aria-haspopup="true" aria-controls="digressions-dropdown-items">
                <span>Digressions</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="dropdown__expand"
                    id="digressions-dropdown-expand">
                    <path d="m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z" />
                </svg>
            </button>
            <ul id="digressions-dropdown-items" class="dropdown__items" role="menu"
                aria-labelledby="digressions-dropdown-button">
                <li class="dropdown__item" role="none">
                    <a class="dropdown__link" role="menuitem" href="/auto-gis-with-rust-blog/digressions/01-creating-the-other-geoarrow-geometry-types/">1: Creating the other GeoArrow geometry types</a>
                </li>
                
                <li class="dropdown__item" role="none">
                    <a class="dropdown__link" role="menuitem" href="/auto-gis-with-rust-blog/digressions/02-continuous-integration-continuous-deployment/">2: Continuous integration / Continuous deployment</a>
                </li>
                </ul>
        </li></ul>
</nav>
    </div>
</header>
<main class="page-body">
    <article>
        <h1>2: Continuous integration / Continuous deployment</h1>
        <p>Coming from Python, my approach to Continuous integration / Continuous deployment (CI/CD) is heavily influenced by Claudio Jolowicz' excellent <a href="https://cjolowicz.github.io/posts/hypermodern-python-01-setup/">Hypermodern Python</a> series.</p>
<h2>For the Rust repo</h2>
<p>This approach is very similar to the one that Luca Palmieri advocates for in the <a href="https://www.lpalmieri.com/posts/2020-06-06-zero-to-production-1-setup-toolchain-ides-ci/#6-continuous-integration">continuous integration section</a> of the draft version of his <a href="https://www.zero2prod.com">Zero To Production In Rust</a>.</p>
<p>However, Luca uses <a href="https://github.com/actions-rs"><code>actions-rs</code></a>, which is, unfortunately, <a href="https://github.com/actions-rs/toolchain/issues/216">currently unmaintained</a>.</p>
<p><a href="https://www.reddit.com/r/rust/comments/vyx4oj/comment/ig54zv7/?utm_source=share&amp;utm_medium=web2x&amp;context=3">Like many others</a>, I have, therefore, switched to using David Tolnay's <a href="https://github.com/dtolnay/rust-toolchain">Rust Toolchain GitHub Action</a>.</p>
<h3>Continuous integration workflow</h3>
<p>Format on push or pull with <code>cargo fmt</code></p>
<pre class="language-yml"><code class="language-yml"><span class="token comment"># ci.yml</span><br><br><span class="token key atrule">name</span><span class="token punctuation">:</span> Continuous integration<br><span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">,</span> pull_request<span class="token punctuation">]</span><br><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">format</span><span class="token punctuation">:</span><br>    <span class="token key atrule">name</span><span class="token punctuation">:</span> Format<br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout repo<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3<br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Rust<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> dtolnay/rust<span class="token punctuation">-</span>toolchain@v1<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">toolchain</span><span class="token punctuation">:</span> stable<br>          <span class="token key atrule">components</span><span class="token punctuation">:</span> rustfmt<br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run `fmt`<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>          cargo fmt --all</span></code></pre>
<p>Commit any changes</p>
<pre class="language-diff-yml"><code class="language-diff-yml"># ci.yml<br><br># ...<br><br><span class="token unchanged language-yml"><span class="token prefix unchanged"> </span>     <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run `fmt`<br><span class="token prefix unchanged"> </span>       <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br><span class="token prefix unchanged"> </span>         cargo fmt --all</span><br></span><span class="token inserted-sign inserted language-yml"><span class="token prefix inserted">+</span>        <br><span class="token prefix inserted">+</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Commit and push<br><span class="token prefix inserted">+</span>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br><span class="token prefix inserted">+</span>          git config --global user.name 'Your name'<br><span class="token prefix inserted">+</span>          git config --global user.email 'Your@email.address'<br><span class="token prefix inserted">+</span>          git git commit -am "Format with `cargo fmt`"<br><span class="token prefix inserted">+</span>          git push</span></code></pre>
<p>Use secrets instead of hard coding git user info</p>
<pre class="language-diff-yml"><code class="language-diff-yml"># ci.yml<br><br># ...<br><br><span class="token unchanged language-yml"><span class="token prefix unchanged"> </span>     <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Commit and push<br><span class="token prefix unchanged"> </span>       <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><br></span><span class="token deleted-sign deleted language-yml"><span class="token prefix deleted">-</span>          git config <span class="token punctuation">-</span><span class="token punctuation">-</span>global user.name 'Your name'<br></span><span class="token inserted-sign inserted language-yml"><span class="token prefix inserted">+</span>          git config <span class="token punctuation">-</span><span class="token punctuation">-</span>global user.name $<br></span><span class="token deleted-sign deleted language-yml"><span class="token prefix deleted">-</span>          git config <span class="token punctuation">-</span><span class="token punctuation">-</span>global user.email 'Your@email.address'<br></span><span class="token inserted-sign inserted language-yml"><span class="token prefix inserted">+</span>          git config <span class="token punctuation">-</span><span class="token punctuation">-</span>global user.email $<br></span><span class="token unchanged language-yml"><span class="token prefix unchanged"> </span>         git git commit <span class="token punctuation">-</span>am "Format with `cargo fmt`"<br><span class="token prefix unchanged"> </span>         git push</code></pre>
<p>Only commit if there were changes</p>
<pre class="language-diff-yml"><code class="language-diff-yml"># ci.yml<br><br># ...<br><br><span class="token unchanged language-yml"><span class="token prefix unchanged"> </span>     <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Commit and push<br><span class="token prefix unchanged"> </span>       <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br><span class="token prefix unchanged"> </span>         git config --global user.name $<br><span class="token prefix unchanged"> </span>         git config --global user.email $</span><br></span><span class="token deleted-sign deleted language-yml"><span class="token prefix deleted">-</span>          git git commit <span class="token punctuation">-</span>am "Format with `cargo fmt`"<br></span><span class="token inserted-sign inserted language-yml"><span class="token prefix inserted">+</span>          git add . <span class="token important">&amp;&amp;</span> git diff <span class="token punctuation">-</span><span class="token punctuation">-</span>staged <span class="token punctuation">-</span><span class="token punctuation">-</span>quiet <span class="token punctuation">|</span><span class="token punctuation">|</span> git commit <span class="token punctuation">-</span>m "Format with `cargo fmt`"<br></span><span class="token unchanged language-yml"><span class="token prefix unchanged"> </span>         git push</code></pre>
<p>Add linting with <code>clippy</code>:</p>
<pre class="language-diff-yml"><code class="language-diff-yml"># ci.yml<br><br># ...<br><br><span class="token unchanged language-yml"><span class="token prefix unchanged"> </span>     <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Commit and push<br><span class="token prefix unchanged"> </span>       <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br><span class="token prefix unchanged"> </span>         git config --global user.name $<br><span class="token prefix unchanged"> </span>         git config --global user.email $<br><span class="token prefix unchanged"> </span>         git add . &amp;&amp; git diff --staged --quiet || git commit -m "Format with `cargo fmt`"<br><span class="token prefix unchanged"> </span>         git push</span><br></span><span class="token inserted-sign inserted language-yml"><span class="token prefix inserted">+</span>  <br><span class="token prefix inserted">+</span>  <span class="token key atrule">lint</span><span class="token punctuation">:</span><br><span class="token prefix inserted">+</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> Lint<br><span class="token prefix inserted">+</span>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br><span class="token prefix inserted">+</span>    <span class="token key atrule">needs</span><span class="token punctuation">:</span> format<br><span class="token prefix inserted">+</span>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br><span class="token prefix inserted">+</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout repo<br><span class="token prefix inserted">+</span>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3<br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Rust<br><span class="token prefix inserted">+</span>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> dtolnay/rust<span class="token punctuation">-</span>toolchain@v1<br><span class="token prefix inserted">+</span>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br><span class="token prefix inserted">+</span>          <span class="token key atrule">toolchain</span><span class="token punctuation">:</span> stable<br><span class="token prefix inserted">+</span>          <span class="token key atrule">components</span><span class="token punctuation">:</span> clippy<br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run `clippy`<br><span class="token prefix inserted">+</span>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br><span class="token prefix inserted">+</span>          cargo clippy -- -D warnings</span></code></pre>
<p>Add tests with <code>test</code>:</p>
<pre class="language-diff-yml"><code class="language-diff-yml"># ci.yml<br><br># ...<br><br><span class="token unchanged language-yml"><span class="token prefix unchanged"> </span>     <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run `clippy`<br><span class="token prefix unchanged"> </span>       <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br><span class="token prefix unchanged"> </span>         cargo clippy -- -D warnings</span><br></span><br><span class="token inserted-sign inserted language-yml"><span class="token prefix inserted">+</span>  <span class="token key atrule">test</span><span class="token punctuation">:</span><br><span class="token prefix inserted">+</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> Test<br><span class="token prefix inserted">+</span>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br><span class="token prefix inserted">+</span>    <span class="token key atrule">needs</span><span class="token punctuation">:</span> format<br><span class="token prefix inserted">+</span>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br><span class="token prefix inserted">+</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout repo<br><span class="token prefix inserted">+</span>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3<br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Rust<br><span class="token prefix inserted">+</span>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> dtolnay/rust<span class="token punctuation">-</span>toolchain@v1<br><span class="token prefix inserted">+</span>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br><span class="token prefix inserted">+</span>          <span class="token key atrule">toolchain</span><span class="token punctuation">:</span> stable<br><span class="token prefix inserted">+</span><br><span class="token prefix inserted">+</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run tests<br><span class="token prefix inserted">+</span>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br><span class="token prefix inserted">+</span>          cargo test</span></code></pre>
<h3>Security audit workflow</h3>
<pre class="language-yml"><code class="language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Security audit<br><br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">paths</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token string">'**/Cargo.toml'</span><br>      <span class="token punctuation">-</span> <span class="token string">'**/Cargo.lock'</span><br>  <span class="token key atrule">schedule</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> <span class="token key atrule">cron</span><span class="token punctuation">:</span> <span class="token string">'0 0 * * *'</span><br><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">audit</span><span class="token punctuation">:</span><br>    <span class="token key atrule">name</span><span class="token punctuation">:</span> Audit dependencies<br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout repo<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3<br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Rust<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> dtolnay/rust<span class="token punctuation">-</span>toolchain@v1<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">toolchain</span><span class="token punctuation">:</span> stable<br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run audit<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>          cargo install cargo-audit<br>          cargo audit</span></code></pre>

    </article>
</main>

    <script src="/auto-gis-with-rust-blog/js/index.js"></script>
</body>

</html>